<div th:fragment="content" class="p-4">
  <h2 class="text-2xl font-bold mb-2">Alertas de Pre√ßo</h2>
  <p class="text-gray-600 mb-4">
    Configure alertas para ser notificado quando os pre√ßos atingirem
    determinados valores
  </p>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- Formul√°rio -->
    <form
      th:action="@{/notifications}"
      method="post"
      class="border p-4 rounded shadow"
    >
      <h3 class="text-lg font-semibold mb-2">Criar Novo Alerta</h3>

      <label class="block mb-1">Criptomoeda</label>
      <div
        id="select-moeda"
        th:attr="hx-get=@{/notifications/fragment-pares(symbol=${moedaSelecionada})}"
        hx-trigger="load"
        hx-target="#select-moeda"
        hx-swap="outerHTML"
      >
        <select disabled class="w-full p-2 border rounded mb-3">
          <option>Carregando...</option>
        </select>
      </div>

      <label class="block mb-1">Condi√ß√£o</label>
      <select
        id="condicaoSelect"
        name="condicao"
        class="w-full p-2 border rounded mb-3"
      >
        <option value="ACIMA">Acima do valor</option>
        <option value="ABAIXO">Abaixo do valor</option>
      </select>

      <label class="block mb-1">Pre√ßo Alvo</label>
      <input
        id="precoAlvoInput"
        type="number"
        min="0.00000001"
        step="0.00000001"
        name="precoAlvo"
        class="w-full p-2 border rounded mb-3"
      />
      <button type="submit" class="bg-black text-white p-2 w-full rounded">
        Criar Alerta
      </button>
    </form>

    <!-- Lista de Alertas -->
    <div class="border p-4 rounded shadow">
      <h3 class="text-lg font-semibold mb-2">Seus Alertas Ativos</h3>
      <div
        th:each="alerta, iterStat : ${alertas}"
        class="flex justify-between items-center py-2 border-b"
      >
        <div>
          <strong th:text="${alerta.simboloMoeda}">BTC</strong>
          <span
            th:text="${alerta.condicao == 'ACIMA' ? 'Acima de' : 'Abaixo de'}"
          ></span>
          <span
            th:text="'$' + ${#numbers.formatDecimal(alerta.precoAlvo, 1, 'COMMA', 2, 'POINT')}"
          ></span>
        </div>
        <form
          th:action="@{'/notifications/remover/' + ${iterStat.index}}"
          method="post"
        >
          <button type="submit" class="text-gray-500 hover:text-red-600">
            üóë
          </button>
        </form>
      </div>
    </div>
  </div>
  <script>
    const input = document.getElementById("precoAlvoInput");

    input.addEventListener("blur", () => {
      const valor = input.value.trim().replace(",", "."); // aceita v√≠rgula como decimal
      const numero = Number(valor);

      if (!isNaN(numero)) {
        input.value = numero.toFixed(8); // ‚úÖ for√ßa visual completo no input
      } else {
        input.value = "";
      }
    });
  </script>
</div>
